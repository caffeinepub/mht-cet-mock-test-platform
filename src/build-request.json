{
  "kind": "build_request",
  "title": "Fix Admin panel visibility in navbar for authenticated admin users",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-107",
      "text": "Update the Navbar.tsx component to ensure the 'Admin' navigation link renders correctly for authenticated users with admin role by verifying the useGetCallerUserRole hook is properly invoked and its return value is correctly checked against 'admin' string, fixing any conditional rendering logic that may be preventing the Admin link from displaying",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "i am admin and i not see admin panel option in manue bar"
        ]
      },
      "acceptanceCriteria": [
        "Admin users can see the 'Admin' navigation link in the menu bar when authenticated",
        "The Admin link is visible in both desktop and mobile navigation menus for admin role users",
        "Non-admin users continue to not see the Admin link",
        "The useGetCallerUserRole hook correctly returns 'admin' for admin users and the conditional rendering logic properly handles this value"
      ]
    },
    {
      "id": "REQ-108",
      "text": "Debug and fix the useGetCallerUserRole hook in frontend/src/hooks/useQueries.ts to ensure it correctly fetches and returns the user role from the backend getUserRole endpoint, handling the response properly and returning 'admin' for admin users, 'student' for students, or null/undefined for unauthenticated users",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "i am admin and i not see admin panel option in manue bar"
        ]
      },
      "acceptanceCriteria": [
        "The useGetCallerUserRole hook successfully calls the backend getUserRole endpoint when user is authenticated",
        "The hook correctly transforms the backend response into a usable role string ('admin' or 'student')",
        "The hook returns null or undefined when user is not authenticated",
        "React Query caching and invalidation work correctly for role data"
      ]
    },
    {
      "id": "REQ-109",
      "text": "Verify and fix the backend getUserRole endpoint in backend/main.mo to ensure it correctly identifies admin users by checking the caller's principal against the stored admin principals list or admin token validation logic, returning the correct role value ('admin' or 'student') based on the authorization check",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "i am admin and i not see admin panel option in manue bar"
        ]
      },
      "acceptanceCriteria": [
        "The getUserRole endpoint correctly identifies authenticated admin users and returns 'admin' role",
        "The endpoint returns 'student' role for authenticated non-admin users",
        "The endpoint handles unauthenticated calls appropriately",
        "Admin principal checking or token validation logic works correctly"
      ]
    },
    {
      "id": "REQ-110",
      "text": "Add comprehensive console logging to the Navbar.tsx component that logs the authentication state from useInternetIdentity, the user role value from useGetCallerUserRole, and the conditional rendering decision for the Admin link to help diagnose why the Admin link is not appearing for admin users",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "i am admin and i not see admin panel option in manue bar"
        ]
      },
      "acceptanceCriteria": [
        "Console logs show the isAuthenticated value when Navbar renders",
        "Console logs show the userRole value returned from useGetCallerUserRole hook",
        "Console logs show whether the Admin link conditional rendering evaluates to true or false",
        "Logs help identify where in the chain the admin role check is failing"
      ]
    }
  ],
  "constraints": [
    "Do not modify the useInternetIdentity.ts or useInternetIdentity.tsx hooks as they are in immutablePaths",
    "Do not modify the useActor.ts hook as it is in immutablePaths",
    "Maintain backward compatibility with existing student user navigation experience",
    "Preserve the existing conditional rendering pattern for role-based UI elements"
  ],
  "nonGoals": [
    "Redesigning the navigation menu layout or styling",
    "Adding new admin features or dashboard functionality",
    "Modifying the authentication flow or Internet Identity integration",
    "Changing how admin roles are assigned to users"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}